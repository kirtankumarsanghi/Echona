<!DOCTYPE html>
<html>
<head>
    <title>Complete Test - ECHONA</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin: 20px 0;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .section h2 {
            margin-bottom: 15px;
            color: #667eea;
        }
        button {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status.success {
            background: #10b981;
        }
        .status.error {
            background: #ef4444;
        }
        .status.pending {
            background: #f59e0b;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border-left: 4px solid #667eea;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .mood-btn {
            padding: 20px;
            font-size: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .mood-btn span:first-child {
            font-size: 40px;
        }
        input {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            margin: 10px 0;
        }
        input::placeholder {
            color: rgba(255,255,255,0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ ECHONA Complete System Test</h1>

        <!-- Step 1: Backend Check -->
        <div class="section">
            <h2>1Ô∏è‚É£ Backend Connection</h2>
            <button onclick="testBackend()">Test Backend</button>
            <span id="backend-status" class="status pending">Not Tested</span>
            <div id="backend-result" class="result" style="display:none;"></div>
        </div>

        <!-- Step 2: Login -->
        <div class="section">
            <h2>2Ô∏è‚É£ Authentication</h2>
            <input type="email" id="email" placeholder="Email" value="admin@echona.com">
            <input type="password" id="password" placeholder="Password" value="admin123">
            <button onclick="testLogin()">Login</button>
            <button onclick="clearStorage()">Clear Storage</button>
            <span id="auth-status" class="status pending">Not Logged In</span>
            <div id="auth-result" class="result" style="display:none;"></div>
        </div>

        <!-- Step 3: Mood Detection -->
        <div class="section">
            <h2>3Ô∏è‚É£ Mood Detection (Manual)</h2>
            <div class="mood-grid">
                <button class="mood-btn" onclick="saveMood('Happy', 8)">
                    <span>üòä</span>
                    <span>Happy</span>
                </button>
                <button class="mood-btn" onclick="saveMood('Sad', 4)">
                    <span>üò¢</span>
                    <span>Sad</span>
                </button>
                <button class="mood-btn" onclick="saveMood('Angry', 6)">
                    <span>üò†</span>
                    <span>Angry</span>
                </button>
                <button class="mood-btn" onclick="saveMood('Calm', 7)">
                    <span>üòå</span>
                    <span>Calm</span>
                </button>
                <button class="mood-btn" onclick="saveMood('Excited', 9)">
                    <span>ü§©</span>
                    <span>Excited</span>
                </button>
                <button class="mood-btn" onclick="saveMood('Anxious', 5)">
                    <span>üò∞</span>
                    <span>Anxious</span>
                </button>
            </div>
            <span id="mood-status" class="status pending">Not Tested</span>
            <div id="mood-result" class="result" style="display:none;"></div>
        </div>

        <!-- Step 4: AI Text Analysis -->
        <div class="section">
            <h2>4Ô∏è‚É£ AI Text Analysis</h2>
            <input type="text" id="moodText" placeholder="Type how you feel..." value="I am feeling really happy and excited today!">
            <button onclick="analyzeMood()">Analyze Text</button>
            <span id="ai-status" class="status pending">Not Tested</span>
            <div id="ai-result" class="result" style="display:none;"></div>
        </div>

        <!-- Step 5: Mood History -->
        <div class="section">
            <h2>5Ô∏è‚É£ Mood History</h2>
            <button onclick="getMoodHistory()">Get History</button>
            <span id="history-status" class="status pending">Not Tested</span>
            <div id="history-result" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000';
        let token = localStorage.getItem('echona_token');

        function updateStatus(id, success, message) {
            const el = document.getElementById(id);
            el.className = `status ${success ? 'success' : 'error'}`;
            el.textContent = success ? '‚úì ' + message : '‚úó ' + message;
        }

        function showResult(id, content) {
            const el = document.getElementById(id);
            el.textContent = typeof content === 'object' ? JSON.stringify(content, null, 2) : content;
            el.style.display = 'block';
        }

        async function testBackend() {
            try {
                const response = await fetch(`${API_URL}/`);
                const data = await response.json();
                updateStatus('backend-status', true, 'Connected');
                showResult('backend-result', data);
            } catch (error) {
                updateStatus('backend-status', false, 'Failed');
                showResult('backend-result', error.message);
            }
        }

        async function testLogin() {
            try {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok && data.token) {
                    token = data.token;
                    localStorage.setItem('echona_token', token);
                    localStorage.setItem('echona_user', JSON.stringify(data.user));
                    updateStatus('auth-status', true, 'Logged In');
                    showResult('auth-result', `Token: ${token.substring(0, 30)}...\nUser: ${JSON.stringify(data.user, null, 2)}`);
                } else {
                    updateStatus('auth-status', false, data.message || 'Login Failed');
                    showResult('auth-result', data);
                }
            } catch (error) {
                updateStatus('auth-status', false, 'Error');
                showResult('auth-result', error.message);
            }
        }

        async function saveMood(mood, score) {
            if (!token) {
                alert('Please login first!');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/mood/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ mood, score })
                });

                const data = await response.json();

                if (response.ok) {
                    updateStatus('mood-status', true, `${mood} Saved!`);
                    showResult('mood-result', data);
                } else {
                    updateStatus('mood-status', false, 'Failed');
                    showResult('mood-result', data);
                }
            } catch (error) {
                updateStatus('mood-status', false, 'Error');
                showResult('mood-result', error.message);
            }
        }

        async function analyzeMood() {
            if (!token) {
                alert('Please login first!');
                return;
            }

            try {
                const text = document.getElementById('moodText').value;
                const response = await fetch(`${API_URL}/api/mood/analyze-text`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ text })
                });

                const data = await response.json();

                if (response.ok) {
                    updateStatus('ai-status', true, `Detected: ${data.mood}`);
                    showResult('ai-result', data);
                } else {
                    updateStatus('ai-status', false, 'Failed');
                    showResult('ai-result', data);
                }
            } catch (error) {
                updateStatus('ai-status', false, 'Error');
                showResult('ai-result', error.message);
            }
        }

        async function getMoodHistory() {
            if (!token) {
                alert('Please login first!');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/api/mood/history`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    updateStatus('history-status', true, `${data.length} entries`);
                    showResult('history-result', data);
                } else {
                    updateStatus('history-status', false, 'Failed');
                    showResult('history-result', data);
                }
            } catch (error) {
                updateStatus('history-status', false, 'Error');
                showResult('history-result', error.message);
            }
        }

        function clearStorage() {
            localStorage.clear();
            token = null;
            updateStatus('auth-status', false, 'Cleared');
            alert('Local storage cleared!');
        }

        // Auto test backend on load
        window.onload = () => {
            testBackend();
            if (token) {
                updateStatus('auth-status', true, 'Token Found');
            }
        };
    </script>
</body>
</html>
